		ORG	00H
		AJMP	MAIN
		ORG	30H
MAIN:		MOV	TMOD,#20H
		MOV	TH1,#0FDH
		MOV	TL1,#0FDH	
	
		MOV	SCON,#0D8H
		MOV	PCON,#0
		SETB	TR1
		MOV	R5,#00H

		MOV 	R6,#00H
		MOV 	R7,#00H
		
LOOP:		
		;MOV	P2,R5
		MOV	A,#0FFH
		MOV	P3,A
		
		JNB	P3.3,PRESTX
		JNB	P3.5,PRESRX
		AJMP	LOOP

PRESTX:		JNB	P3.3,$
		MOV	R2,#07H			;从机1的地址送R2
		CALL	MSIO1
		AJMP	LOOP

PRESRX:		JNB	P3.5,$
		MOV	R3,#0FH			;从机1的地址送R3
		CALL	MSIO2
		AJMP	LOOP

MSIO1:		MOV	A,R2
		SETB	TB8
		MOV	SBUF,A
				
		JNB	TI,$
		CLR	TI
		JNB	RI,$
		CLR	RI
		MOV	A,SBUF
		XRL	A,R2
		JZ	MSIO3
		RET
MSIO3:		CLR	TB8
		INC 	R7
		CJNE 	R7,#0AH,L1
		MOV	R7,#00H
L1:		MOV	A,R7
		MOV	SBUF,A
		JNB	TI,$
		CLR	TI
		RET

MSIO2:		MOV	A,R3
		SETB	TB8
		MOV	SBUF,A
		JNB	TI,$ 
		CLR	TI
		JNB	RI,$
		CLR	RI
		MOV	A,SBUF
		XRL	A,R3
		JZ	MSIO7
		RET
MSIO7:		CLR	TB8
		INC 	R6
		CJNE 	R6,#0AH,L2
		MOV	R6,#00H
L2:		
		MOV	A,R6
		MOV	SBUF,A
		JNB	TI,$
		CLR	TI
		RET
		END

		
