SLAVE		EQU	30H

		ORG	00H
		AJMP	MAIN
		ORG	23H
		LJMP	SSIO
		ORG	30H
MAIN:		MOV	TMOD,#20H
		MOV	TH1,#0FDH
		MOV	TL1,#0FDH	
		SETB	EA		;串行口开中断
		SETB	ES
		MOV	SCON,#0D8H
		MOV	PCON,#0
		SETB	TR1
		SETB	SM2
	
		MOV	A,#0FFH
		MOV	P1,A
		MOV	A,P1
		MOV	SLAVE,A
		MOV	R5,#00H
DISPLAY:	MOV	P2,R5
		SETB	P3.7
		JB	P3.7,$
		JNB	P3.7,$
		INC	R5
		AJMP	DISPLAY

SSIO:		CLR	RI
		
		PUSH	ACC
		PUSH	PSW
		SETB	RS1
		CLR	RS0
		JNB	RB8,RETURN
		MOV	A,SBUF
		XRL	A,SLAVE
		JZ	SSIO1
RETURN:		POP	PSW
		POP	ACC
		
		RETI

SSIO1:		CLR	SM2
		MOV	SBUF,SLAVE
		JNB	RI,$
		CLR	RI
		JNB	RB8,SSIO2
		SETB	SM2
		SJMP	RETURN
SSIO2:		MOV	A,SBUF
		CJNE	A,#2H,NEXT
NEXT:		JC	SSIO3
		CLR	TI
		MOV	SBUF,#80H
		SJMP	RETURN
SSIO3:		JZ	SSIO5
SSIO4:		MOV	SBUF,#2H
		CLR	TI
LOOP1:		MOV	SBUF,R5
		SETB	SM2
		SJMP	RETURN

SSIO5:		MOV	SBUF,#01H
LOOP2:		JNB	RI,$
		CLR	RI
		MOV	R5,SBUF
		SJMP	RETURN
		END




